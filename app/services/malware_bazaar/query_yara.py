from app.config.instances import malwarebazaar_instance as instance
import requests

def query_yara(yara_name: str) -> dict:

        """
        Query for information related to a given YARA rule name using the MalwareBazaar API.

        This function performs an HTTP POST request to the MalwareBazaar API to fetch information
        related to a YARA rule identified by its name. The query is limited to 10 results and is localized to '100'.

        Parameters:
        yara_name (str): The YARA rule name to query.

        Returns:
        dict: A dictionary containing the query results if the query is successful. Otherwise, a dictionary
            containing an error message.

        Raises:
        None: This function handles exceptions and returns an error message in the dictionary.

        """
        
        payload = {
        "query": "get_yarainfo",
            "yara_rule": yara_name,
            "loc": "100",
            "limit": "10"
            }

        response = requests.post(instance.API_URL, headers=instance.auth_headers, data=payload)

        if response.status_code == 200:
            data = response.json()
            #print(data)
            return data
        else:
            return {"error": "Failed to post YARA name to MalwareBazaar API"}
