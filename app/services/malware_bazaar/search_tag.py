from app.config.instances import malwarebazaar_instance as instance
import requests

def search_tag(tag: str) -> dict:

        """
        Query for information related to a given tag using the MalwareBazaar API.

        This function performs an HTTP POST request to the MalwareBazaar API to fetch information
        related to a tag. The query is limited to 10 results and is localized to '100'.

        Parameters:
        tag (str): The tag to query.

        Returns:
        dict: A dictionary containing the query results if the query is successful.

        Raises:
        None: This function handles exceptions and returns an error message in the dictionary.

        """ 
        payload = {
        "query": "get_taginfo",
            "tag": tag,
            "loc": "100",
            "limit": "10"
            }

        response = requests.post(instance.API_URL, headers=instance.auth_headers, data=payload)

        if response.status_code == 200:
            data = response.json()
            return data
        else:
            return {"error": "Failed to post hash to MalwareBazaar API"}
