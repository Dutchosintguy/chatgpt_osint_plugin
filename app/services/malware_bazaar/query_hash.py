from app.config.instances import malwarebazaar_instance as instance
import requests

def query_hash(hash_value: str) -> dict:
 
        """
        Query for information related to a given hash value using the MalwareBazaar API.

        This function performs an HTTP POST request to the MalwareBazaar API to fetch information
        related to a file identified by its hash value. The query is limited to 15 results and is localized to '100'.

        Parameters:
        hash_value (str): The hash value to query. Should be a valid SHA-256, SHA-1, or MD5 hash.

        Returns:
        dict: A dictionary containing the query results if the query is successful.
        
        Raises:
        None: This function handles exceptions and returns an error message in the dictionary.

        """

        payload = {
            "query": "get_info",
            "hash": hash_value,
            "loc": "100",
            "limit": "15"
            }

        response = requests.post(instance.API_URL, headers=instance.auth_headers, data=payload)

        if response.status_code == 200:
            data = response.json()
            return data
        else:
            return {"error": "Failed to post hash to MalwareBazaar API."}
